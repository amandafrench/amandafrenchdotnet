jQuery(document).ready(function(){var i,l,p,u,c,d,t,e,a,g;function y(){var e;0!=jQuery("div.zp-List .csl-left-margin",i).length&&/\d/.test(jQuery("div.zp-List .csl-left-margin",i).text())&&(e=1,jQuery("div.zp-List .csl-left-margin",i).each(function(){jQuery(this).text(jQuery(this).text().replace(/(\d+)/,e)),e++}))}0<jQuery("#zp-Browse-Collections-Select").length&&(i=jQuery("#zp-Browse-Collections-Select").parents().eq(3),l=!1,0<jQuery("#ZP_COLLECTION_ID",i).length&&(l=jQuery("#ZP_COLLECTION_ID",i).text()),p=!1,0<jQuery("#ZP_TAG_ID",i).length&&(p=jQuery("#ZP_TAG_ID",i).text()),u=!1,0<jQuery("#ZP_SHOWTAGS").length&&"1"==parseInt(jQuery("#ZP_SHOWTAGS").text())&&(u=!0),c=!1,0<jQuery("#ZP_SHOWIMAGE",i).length&&("yes"==jQuery("#ZP_SHOWIMAGE",i).text()||"true"==jQuery("#ZP_SHOWIMAGE",i).text()||"1"==jQuery("#ZP_SHOWIMAGE",i).text())&&(c=!0),d=!1,0<jQuery("#ZP_ISADMIN",i).length&&(d=!0),t=!1,0<jQuery("#ZP_TARGET",i).length&&0<jQuery("#ZP_TARGET").text().length&&(t=!0),e=!1,0<jQuery("#ZP_TOPLEVEL",i).length&&(e=jQuery("#ZP_TOPLEVEL",i).text(),!1===l&&(l=e)),a=!1,0<jQuery("#ZP_URLWRAP",i).length&&(a=jQuery("#ZP_URLWRAP",i).text()),function t(e,a,r){void 0!==e&&"false"!=e&&""!=e||(e=0);void 0!==a&&"false"!=a&&""!=a||(a=0);jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID",i).text(),item_type:"collections",collection_id:l,request_start:e,request_last:a,sortby:"title",get_top:!0,update:r,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var e=jQuery.parseJSON(e),s="";!1===r&&jQuery("select#zp-Browse-Collections-Select",i).addClass("used_cache"),!0!==r||jQuery("select#zp-Browse-Collections-Select",i).hasClass("updating")||(jQuery("select#zp-Browse-Collections-Select",i).find("*").not(".blank").remove(),jQuery("select#zp-Browse-Collections-Select",i).addClass("updating"),p&&jQuery("select#zp-Browse-Collections-Select",i).append("<option value='blank'>--"+zpShortcodeAJAX.txt_nocollsel+"--</option>")),l&&0==jQuery("#zp-Browse-Collections-Select option.blank",i).length&&0<jQuery("#ZP_COLLECTION_NAME",i).length&&jQuery("select#zp-Browse-Collections-Select",i).append("<option value='blank' class='blank'>"+jQuery("#ZP_COLLECTION_NAME",i).text()+"</option>\n"),"0"!=e&&0<e.data.length&&"0"!=e.data&&(jQuery.each(e.data,function(e,t){var a="<option value='"+t.key+"'";l==t.key&&(a+=" selected='selected'"),a+=">",l&&(a+="- "),a+=t.data.name+" (",0<t.meta.numCollections&&(a+=t.meta.numCollections+" "+zpShortcodeAJAX.txt_subcoll+", "),a+=t.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",s+=a}),jQuery("select#zp-Browse-Collections-Select",i).append(s),0!=e.meta.request_next&&"false"!=e.meta.request_next?t(e.meta.request_next,e.meta.request_last,r):jQuery("select#zp-Browse-Collections-Select",i).hasClass("updating")||t(0,0,!0)),l&&"toplevel"!=l&&0==jQuery("#zp-Browse-Collections-Select option.toplevel",i).length&&jQuery("select#zp-Browse-Collections-Select",i).append("<option value='toplevel' class='toplevel'>&larr; "+zpShortcodeAJAX.txt_backtotop+"</option>\n"),jQuery("select#zp-Browse-Collections-Select",i).removeClass("loading").find(".loading").remove()},error:function(e){console.log("Error for zp_get_collections(): ",e.statusText)},complete:function(e,t){}})}(0,0,!(g=!0)),function t(e,a,r){void 0!==e&&"false"!=e&&""!=e||(e=0);void 0!==a&&"false"!=a&&""!=a||(a=0);jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID",i).text(),item_type:"tags",is_dropdown:!0,maxtags:jQuery("#ZP_MAXTAGS",i).text(),request_start:e,request_last:a,update:r,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var e=jQuery.parseJSON(e),s="<option id='zp-List-Tags-Select' name='zp-List-Tags-Select'>--"+zpShortcodeAJAX.txt_notagsel+"--</option>\n";p&&(s="<option value='toplevel' class='toplevel'>--"+zpShortcodeAJAX.txt_unsettag+"--</option>\n"),!1===r&&jQuery("select#zp-List-Tags",i).addClass("used_cache"),!0!==r||jQuery("select#zp-List-Tags",i).hasClass("updating")||jQuery("select#zp-List-Tags",i).empty().addClass("updating"),0!==e&&0<e.data.length?(jQuery.each(e.data,function(e,t){var a="<option class='zp-List-Tag' value='"+t.tag.replace(/ /g,"+")+"'";0<jQuery("#ZP_TAG_ID",i).length&&jQuery("#ZP_TAG_ID",i).text()==t.tag&&(a+=" selected='selected'"),a+=">"+t.tag+" ("+t.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",s+=a}),jQuery("select#zp-List-Tags",i).append(s),0!=e.meta.request_next&&"false"!=e.meta.request_next?t(e.meta.request_next,e.meta.request_last,r):jQuery("select#zp-List-Tags",i).hasClass("updating")||t(0,0,!0),jQuery("select#zp-List-Tags",i).removeClass("loading").find(".loading").remove()):(jQuery("select#zp-List-Tags",i).removeClass("loading").find(".loading").remove(),jQuery("select#zp-List-Tags",i).append("<option rel='empty' value='empty'>"+zpShortcodeAJAX.txt_notags+"</option>"))},error:function(e){console.log("Error for zp_get_tags(): ",e.statusText)},complete:function(e,t){}})}(0,0,!1),function r(o,e,n){void 0!==o&&"false"!=o&&""!=o||(o=0);void 0!==e&&"false"!=e&&""!=e||(e=0);jQuery(".zp-List",i).hasClass("loading")&&""==jQuery(".zp-List",i).find(".zp_display_progress").text()&&jQuery(".zp-List",i).append("<div class='zp_display_progress'>"+zpShortcodeAJAX.txt_loading+" ...</div>");jQuery.ajax({async:!0,url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID",i).text(),is_dropdown:!0,item_type:"items",citeable:jQuery("#ZP_CITEABLE",i).text(),downloadable:jQuery("#ZP_DOWNLOADABLE",i).text(),showtags:u,showimage:c,target:t,urlwrap:a,collection_id:l,tag_id:p,get_top:!0,sortby:jQuery("#ZP_SORTBY",i).text(),order:jQuery("#ZP_ORDER",i).text(),update:n,request_start:o,request_last:e,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var l,a,s,t=jQuery.parseJSON(e);!1===n?jQuery(".zp-List",i).addClass("used_cache"):!0===n&&(jQuery(".zp-List",i).hasClass("updating")||jQuery(".zp-List",i).addClass("updating")),void 0!==t&&null!=t&&0!=t&&0<t.data.length?(l="",jQuery(".zp-List",i).hasClass("updating")||!1===t.meta.request_last||"false"==t.meta.request_last||0===t.meta.request_last||jQuery(".zp-List",i).find(".zp_display_progress").html("Loading "+t.meta.request_next+"-"+(t.meta.request_next+50)+" out of "+(parseInt(t.meta.request_last)+50)+"..."),0!=t.data&&jQuery.each(t.data,function(e,t){var a="",s=jQuery("div.zp-List #zp-ID-"+t.library.id+"-"+t.key,i),r="0000";t.meta.hasOwnProperty("parsedDate")&&(r=t.meta.parsedDate.substring(0,4));var o=t.data.title;t.meta.hasOwnProperty("creatorSummary")&&(o=t.meta.creatorSummary.replace(/ /g,"-")),a+="<div id='zp-ID-"+t.library.id+"-"+t.key+"' class='zp-Entry zpSearchResultsItem hidden",!0===n&&(a+=" zp_updated"),a+="' data-zp-author-year='"+o+"-"+r+"'",a+="' data-zp-year-author='"+r+"-"+o+"'",a+=">\n",(d||c&&t.hasOwnProperty("image"))&&(a+="<div id='zp-Citation-"+t.key+"' class='zp-Entry-Image",t.hasOwnProperty("image")&&(a+=" hasImage"),a+="' rel='"+t.key+"'>\n",t.hasOwnProperty("image")&&(a+="<img class='thumb' src='"+t.image[0]+"' alt='image' />\n"),d&&(t.hasOwnProperty("image")?a+="<a title='Change Image' class='upload' rel='"+t.key+"' href='#'>"+zpShortcodeAJAX.txt_changeimg+"</a>\n":a+="<a title='Set Image' class='upload' rel='"+t.key+"' href='#'>"+zpShortcodeAJAX.txt_setimg+"</a>\n"),d&&t.hasOwnProperty("image")&&(a+="<a title='Remove Image' class='delete' rel='"+t.key+"' href='#'>&times;</a>\n"),a+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"),a+=t.bib,u&&0<t.data.tags.length&&(a+="<span class='item_key'>Tag(s): ",jQuery.each(t.data.tags,function(e,t){0!=e&&(a+=", "),a+=t.tag})),d&&(a+="<label for='item_key'>"+zpShortcodeAJAX.txt_itemkey+":</label><input type='text' name='item_key' class='item_key' value='"+t.key+"'>\n"),a+="</div>\x3c!-- .zp-Entry --\x3e\n",0<s.length&&!0===n?s.replaceWith(jQuery(a)):l+=a}),!1===n&&jQuery("#zpSearchResultsContainer",i).append(l),0!=t.meta.request_next&&"false"!=t.meta.request_next?(1==g?window.zpACPagination(g,!1):window.zpACPagination(g,!0),g=!1,0==o&&0<t.meta.request_last&&(jQuery("#zpSearchResultsPaging",i).width(50*jQuery("#zpSearchResultsPaging a",i).length+"px"),0==jQuery("#zpSearchResultsPagingScroller",i).length&&(jQuery("#zpSearchResultsPagingCrop",i).width(5*jQuery("#zpSearchResultsPaging a.selected",i).outerWidth()),jQuery("#zpSearchResultsPagingContainer",i).append('<div id="zpSearchResultsPagingScroller"><span id="zpSearchResultsPagingBack">&#8249;</span><span id="zpSearchResultsPagingForward">&#8250;</span></div>'),jQuery("#zpSearchResultsPagingContainer",i).on("click","#zpSearchResultsPagingBack",function(){var e=parseInt(jQuery("#zpSearchResultsPaging",i).css("left")),t=parseInt(jQuery("#zpSearchResultsPaging a.selected",i).css("width"))+2*parseInt(jQuery("#zpSearchResultsPaging a.selected",i).css("border-left-width"));0!=e&&jQuery("#zpSearchResultsPaging",i).css("left",e+t+"px")}),jQuery("#zpSearchResultsPagingContainer",i).on("click","#zpSearchResultsPagingForward",function(){var e=parseInt(jQuery("#zpSearchResultsPaging",i).css("left")),t=parseInt(jQuery("#zpSearchResultsPaging a.selected",i).css("width"))+2*parseInt(jQuery("#zpSearchResultsPaging a.selected",i).css("border-left-width"));-1*e<jQuery("#zpSearchResultsPaging",i).width()-50&&jQuery("#zpSearchResultsPaging",i).css("left",e-t+"px")}))),y(),r(t.meta.request_next,t.meta.request_last,n)):(window.zpACPagination(g),g=!1,jQuery(".zp-List",i).removeClass("loading"),jQuery(".zp-List",i).find(".zp_display_progress").remove(),jQuery(".zp-List",i).hasClass("updating")?(e=jQuery("#ZP_SORTBY",i).text(),a=jQuery("#ZP_ORDER",i).text(),-1!==["author","date"].indexOf(e)&&0==jQuery("div.zp-List .csl-left-margin",i).length&&(s="date"==e?"data-zp-year-author":"data-zp-author-year",jQuery("#"+t.instance+" .zp-List div.zp-Entry",i).sort(function(e,t){var e=e.getAttribute(s).toLowerCase(),t=t.getAttribute(s).toLowerCase();return t<e?"asc"==a?1:-1:e<t?"asc"==a?-1:1:0}).detach().appendTo("#"+t.instance+" .zp-List",i)),y()):r(0,0,!0))):(jQuery(".zp-List",i).removeClass("loading"),jQuery(".zp-List",i).find(".zp_display_progress").remove(),jQuery("#zpSearchResultsContainer",i).append("<p>"+zpShortcodeAJAX.txt_nocitations+"</p>\n"))},error:function(e){console.log("Error for zp_get_items(): ",e.statusText)}})}(0,0,!1))});
